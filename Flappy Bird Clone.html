<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Flappy Bird Clone</title>
<style>
  body {
    margin: 0;
    padding: 0;
    background: #70c5ce;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    overflow: hidden;
  }
  canvas {
    background: #70c5ce;
    border: 3px solid #fff;
    border-radius: 10px;
    max-width: 100%;
    height: auto;
    touch-action: none;
  }
</style>
</head>
<body>
<canvas id="game"></canvas>

<!-- ðŸŽµ Sounds -->
<audio id="bgm" src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3" autoplay loop></audio>
<audio id="jumpSound" src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg"></audio>
<audio id="scoreSound" src="https://actions.google.com/sounds/v1/cartoon/pop.ogg"></audio>
<audio id="hitSound" src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg"></audio>
<audio id="gameOverSound" src="https://actions.google.com/sounds/v1/cartoon/slide_whistle_to_drum_hit.ogg"></audio>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

function resizeCanvas() {
  canvas.width = Math.min(window.innerWidth * 0.9, 400);
  canvas.height = window.innerHeight * 0.8;
}
resizeCanvas();
window.addEventListener("resize", resizeCanvas);

let frames = 0;
const DEGREE = Math.PI/180;

// Bird
const bird = {
  x: 50,
  y: 150,
  w: 30,
  h: 30,
  gravity: 0.25,
  jump: 4.6,
  speed: 0,
  rotation: 0,
  draw(){
    ctx.save();
    ctx.translate(this.x,this.y);
    ctx.rotate(this.rotation);
    ctx.fillStyle="yellow";
    ctx.beginPath();
    ctx.arc(0,0,this.w/2,0,2*Math.PI);
    ctx.fill();
    ctx.restore();
  },
  flap(){
    this.speed = -this.jump;
    document.getElementById("jumpSound").play();
  },
  update(){
    this.speed += this.gravity;
    this.y += this.speed;

    if(this.y+this.h/2 >= canvas.height){
      if(!gameOver){
        document.getElementById("hitSound").play();
        document.getElementById("gameOverSound").play();
      }
      gameOver = true;
    }
    if(this.speed >= this.jump){
      this.rotation = 90*DEGREE;
    } else {
      this.rotation = -25*DEGREE;
    }
  },
  reset(){
    this.y = 150;
    this.speed = 0;
  }
};

// Pipes
const pipes = {
  position: [],
  w: 50,
  gap: 100,
  maxYPos: -150,
  dx: 2,
  draw(){
    ctx.fillStyle="green";
    this.position.forEach(p=>{
      ctx.fillRect(p.x, p.y, this.w, canvas.height);
      ctx.fillRect(p.x, p.y+this.gap+canvas.height, this.w, canvas.height);
    });
  },
  update(){
    if(frames % 100 === 0){
      let y = this.maxYPos * (Math.random()+1);
      this.position.push({x: canvas.width, y:y, passed:false});
    }
    this.position.forEach((p,i)=>{
      p.x -= this.dx;

      // Collision
      if(bird.x+bird.w/2 > p.x && bird.x-bird.w/2 < p.x+this.w &&
        (bird.y-bird.h/2 < p.y+canvas.height || bird.y+bird.h/2 > p.y+this.gap+canvas.height)){
        if(!gameOver){
          document.getElementById("hitSound").play();
          document.getElementById("gameOverSound").play();
        }
        gameOver = true;
      }

      // Score update
      if(!p.passed && p.x + this.w < bird.x){
        p.passed = true;
        score.value++;
        document.getElementById("scoreSound").play();
      }

      if(p.x+this.w <= 0){
        this.position.shift();
      }
    });
  },
  reset(){
    this.position = [];
  }
};

// Score
const score = {
  value: 0,
  draw(){
    ctx.fillStyle="#fff";
    ctx.font="30px Arial";
    ctx.fillText(this.value, canvas.width/2-10, 50);
  },
  reset(){
    this.value = 0;
  }
};

let gameOver = false;

function draw(){
  ctx.fillStyle="#70c5ce";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  pipes.draw();
  bird.draw();
  score.draw();

  if(gameOver){
    ctx.fillStyle="rgba(0,0,0,0.5)";
    ctx.fillRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle="#fff";
    ctx.font="40px Arial";
    ctx.fillText("Game Over", canvas.width/2-100, canvas.height/2);
    ctx.font="20px Arial";
    ctx.fillText("Tap to Restart", canvas.width/2-70, canvas.height/2+40);
  }
}

function update(){
  if(!gameOver){
    bird.update();
    pipes.update();
  }
}

function loop(){
  update();
  draw();
  frames++;
  requestAnimationFrame(loop);
}
loop();

// Restart
function restartGame(){
  bird.reset();
  pipes.reset();
  score.reset();
  gameOver = false;
}

// Controls (PC + Mobile)
document.addEventListener("keydown", e=>{
  if(e.code==="Space" || e.code==="ArrowUp"){
    if(gameOver) restartGame();
    else bird.flap();
  }
});

canvas.addEventListener("click", e=>{
  if(gameOver) restartGame();
  else bird.flap();
});

canvas.addEventListener("touchstart", e=>{
  e.preventDefault();
  if(gameOver) restartGame();
  else bird.flap();
}, {passive:false});
</script>
</body>
</html>
