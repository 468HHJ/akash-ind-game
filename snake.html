<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Advanced Snake Game</title>
<style>
body { margin:0; padding:0; background:#111; color:#fff; font-family:Arial,sans-serif; text-align:center; overflow:hidden;}
h1{margin:5px 0;}
.controls{margin:5px;font-size:14px;}
canvas{display:block;margin:0 auto;background:#222;border:2px solid #fff;touch-action:none;}
.editor{margin-top:5px;display:none;border:1px solid #fff;padding:5px;}
.editor canvas{border:1px solid #fff;background:#000; touch-action:none;}
button{margin-left:5px;}
#gameOver{display:none;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);background:rgba(0,0,0,0.8);padding:20px;border:2px solid red;}
#score{position:absolute;top:10px;left:10px;font-size:20px;}
#highScore{position:absolute;top:10px;right:10px;font-size:20px;}
.mobile-controls{display:none;margin-top:10px;}
@media (max-width:600px){.mobile-controls{display:block;}}
</style>
</head>
<body>

<h1>üêç Advanced Snake Game</h1>

<div class="controls">
  <label>Snake Image: <input type="file" id="snakeImageInput" accept="image/*"></label>
  <label>Food Image: <input type="file" id="foodImageInput" accept="image/*"></label>
  <label>Background Color: <input type="color" id="bgColorPicker" value="#000000"></label>
  <button onclick="changeSpeed()">Speed: Medium</button>
</div>

<div id="snakeEditor" class="editor">
  <h3>Edit Snake Image</h3>
  <canvas id="snakeEditCanvas" width="200" height="200"></canvas><br>
  Zoom: <input type="range" id="snakeZoom" min="0.5" max="3" step="0.1" value="1">
  <button onclick="applySnakeImage()">Apply Snake</button>
  <p>Drag image with mouse or touch to adjust position</p>
</div>

<div id="foodEditor" class="editor">
  <h3>Edit Food Image</h3>
  <canvas id="foodEditCanvas" width="200" height="200"></canvas><br>
  Zoom: <input type="range" id="foodZoom" min="0.5" max="3" step="0.1" value="1">
  <button onclick="applyFoodImage()">Apply Food</button>
  <p>Drag image with mouse or touch to adjust position</p>
</div>

<div id="gameOver">
  <h2>Game Over!</h2>
  <p id="finalScore">Score: 0</p>
  <button onclick="resetGame()">Play Again</button>
</div>

<div id="score">Score: 0</div>
<div id="highScore">High Score: 0</div>

<canvas id="gameCanvas"></canvas>

<div class="mobile-controls">
  <button onclick="moveUp()">‚Üë</button><br>
  <button onclick="moveLeft()">‚Üê</button>
  <button onclick="moveRight()">‚Üí</button><br>
  <button onclick="moveDown()">‚Üì</button>
</div>

<script>
// ---------------- Canvas Setup ----------------
const canvas=document.getElementById("gameCanvas");
const ctx=canvas.getContext("2d");
let gridSize;
resizeCanvas();
window.addEventListener("resize", resizeCanvas);
function resizeCanvas(){
  canvas.width=window.innerWidth-10;
  canvas.height=window.innerHeight-100;
  gridSize=Math.floor(Math.min(canvas.width,canvas.height)/20);
}

// ---------------- Game Variables ----------------
let snake=[{x:9*gridSize,y:9*gridSize,img:null}], dx=gridSize, dy=0;
let food=randomFood();
let snakeImage=null, foodImage=null, bgColor="#000000";
let score=0, highScore=localStorage.getItem("highScore")||0;
let gameSpeed=120, gameRunning=true;
document.getElementById("highScore").textContent=`High Score: ${highScore}`;

// ---------------- Snake & Food Editors ----------------
let snakeEditImg=new Image(), snakeScale=1, snakeOffsetX=0, snakeOffsetY=0;
let foodEditImg=new Image(), foodScale=1, foodOffsetX=0, foodOffsetY=0;

// Helper function for editor drag + zoom
function setupEditor(fileInput, editImg, editorDiv, editCanvas, editScaleSlider, applyFunc){
  fileInput.addEventListener("change", e=>{
    const file=e.target.files[0];
    if(file){ editImg.src=URL.createObjectURL(file);
      editImg.onload=()=>{editorDiv.style.display="block"; drawEditor();}
    }
  });
  editScaleSlider.addEventListener("input", e=>{drawEditor();});
  let dragging=false, lastX=0, lastY=0;
  function drawEditor(){
    const ctx=editCanvas.getContext("2d");
    ctx.clearRect(0,0,editCanvas.width,editCanvas.height);
    const scale=parseFloat(editScaleSlider.value);
    const w=editImg.width*scale, h=editImg.height*scale;
    const x=(editCanvas.width-w)/2+(editorDiv===snakeEditor?snakeOffsetX:foodOffsetX);
    const y=(editCanvas.height-h)/2+(editorDiv===snakeEditor?snakeOffsetY:foodOffsetY);
    ctx.drawImage(editImg,x,y,w,h);
  }
  editCanvas.addEventListener("mousedown", e=>{dragging=true; lastX=e.offsetX; lastY=e.offsetY;});
  editCanvas.addEventListener("mouseup", e=>{dragging=false;});
  editCanvas.addEventListener("mouseleave", e=>{dragging=false;});
  editCanvas.addEventListener("mousemove", e=>{if(dragging){
    if(editorDiv===snakeEditor){snakeOffsetX+=e.offsetX-lastX; snakeOffsetY+=e.offsetY-lastY;} 
    else{foodOffsetX+=e.offsetX-lastX; foodOffsetY+=e.offsetY-lastY;}
    lastX=e.offsetX; lastY=e.offsetY; drawEditor();}});
  // touch support
  editCanvas.addEventListener("touchstart", e=>{dragging=true; lastX=e.touches[0].clientX; lastY=e.touches[0].clientY;});
  editCanvas.addEventListener("touchmove", e=>{if(dragging){
    if(editorDiv===snakeEditor){snakeOffsetX+=e.touches[0].clientX-lastX; snakeOffsetY+=e.touches[0].clientY-lastY;} 
    else{foodOffsetX+=e.touches[0].clientX-lastX; foodOffsetY+=e.touches[0].clientY-lastY;}
    lastX=e.touches[0].clientX; lastY=e.touches[0].clientY; drawEditor(); e.preventDefault();}});
  editCanvas.addEventListener("touchend", e=>{dragging=false;});
  window[applyFunc]=function(){
    if(editorDiv===snakeEditor){snakeImage=new Image(); snakeImage.src=editCanvas.toDataURL(); editorDiv.style.display="none";}
    else{foodImage=new Image(); foodImage.src=editCanvas.toDataURL(); editorDiv.style.display="none";}
  }
}
setupEditor(document.getElementById("snakeImageInput"), snakeEditImg, document.getElementById("snakeEditor"), document.getElementById("snakeEditCanvas"), document.getElementById("snakeZoom"), "applySnakeImage");
setupEditor(document.getElementById("foodImageInput"), foodEditImg, document.getElementById("foodEditor"), document.getElementById("foodEditCanvas"), document.getElementById("foodZoom"), "applyFoodImage");

// ---------------- Game Controls ----------------
document.getElementById("bgColorPicker").addEventListener("input", e=>{bgColor=e.target.value;});
document.addEventListener("keydown", e=>{
  if(e.key==="ArrowUp"&&dy===0){dx=0;dy=-gridSize;}
  else if(e.key==="ArrowDown"&&dy===0){dx=0;dy=gridSize;}
  else if(e.key==="ArrowLeft"&&dx===0){dx=-gridSize;dy=0;}
  else if(e.key==="ArrowRight"&&dx===0){dx=gridSize;dy=0;}
});

// ---------------- Mobile Controls ----------------
function moveUp(){if(dy===0){dx=0;dy=-gridSize;}}
function moveDown(){if(dy===0){dx=0;dy=gridSize;}}
function moveLeft(){if(dx===0){dx=-gridSize;dy=0;}}
function moveRight(){if(dx===0){dx=gridSize;dy=0;}}

// ---------------- Game Functions ----------------
function drawSnake(){snake.forEach((part,index)=>{
  let size=gridSize*1.5;
  if(part.img){ctx.drawImage(part.img,part.x,part.y,size,size);}
  else if(snakeImage){ctx.drawImage(snakeImage,part.x,part.y,size,size);}
  else{ctx.fillStyle=index===0?"lime":"green";ctx.fillRect(part.x,part.y,size,size);}
})}
function drawFood(){let size=gridSize*1.5;
  if(foodImage){ctx.drawImage(foodImage,food.x,food.y,size,size);}
  else{ctx.fillStyle="red";ctx.fillRect(food.x,food.y,size,size);}
}
function randomFood(){return {x:Math.floor(Math.random()*(canvas.width/gridSize))*gridSize,y:Math.floor(Math.random()*(canvas.height/gridSize))*gridSize};}

function update(){
  if(!gameRunning) return;
  const head={x:snake[0].x+dx,y:snake[0].y+dy,img:null};
  if(head.x<0||head.y<0||head.x>=canvas.width||head.y>=canvas.height){gameOver(); return;}
  for(let part of snake){if(head.x===part.x&&head.y===part.y){gameOver(); return;}}
  snake.unshift(head);
  if(head.x===food.x && head.y===food.y){
    score+=10;
    document.getElementById("score").textContent=`Score: ${score}`;
    if(score>highScore){highScore=score; localStorage.setItem("highScore",highScore); document.getElementById("highScore").textContent=`High Score: ${highScore}`;}
    // Add new segment image as food image
    snake[0].img=foodImage?foodImage:null;
    food=randomFood();
  } else {snake.pop();}
}

function gameOver(){gameRunning=false; document.getElementById("gameOver").style.display="block"; document.getElementById("finalScore").textContent=`Score: ${score}`;}
function resetGame(){snake=[{x:9*gridSize,y:9*gridSize,img:null}];dx=gridSize;dy=0;food=randomFood();score=0;document.getElementById("score").textContent=`Score: ${score}`;document.getElementById("gameOver").style.display="none";gameRunning=true;}
function changeSpeed(){if(gameSpeed===120){gameSpeed=80;document.querySelector(".controls button").textContent="Speed: Fast";}
else if(gameSpeed===80){gameSpeed=200;document.querySelector(".controls button").textContent="Speed: Slow";}
else{gameSpeed=120;document.querySelector(".controls button").textContent="Speed: Medium";}
clearInterval(gameInterval); gameInterval=setInterval(gameLoop,gameSpeed);}

// ---------------- Game Loop ----------------
function gameLoop(){ctx.fillStyle=bgColor; ctx.fillRect(0,0,canvas.width,canvas.height); drawSnake(); drawFood(); update();}
let gameInterval=setInterval(gameLoop,gameSpeed);
</script>
</body>
</html>
